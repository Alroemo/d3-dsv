#!/usr/bin/env node

var os = require("os"),
    rw = require("rw").dash,
    iconv = require("iconv-lite"),
    commander = require("commander"),
    dsv = require("../");

commander
    .version(require("../package.json").version)
    .usage("[options] [file]")
    .option("-o, --out <file>", "output file name; defaults to “-” for stdout", "-")
    .option("--input-encoding <encoding>", "input character encoding; defaults to “utf8”", "utf8")
    .option("--output-encoding <encoding>", "output character encoding; defaults to “utf8”", "utf8")
    .parse(process.argv);

rw.readFile(commander.args[0] || "-", function(error, text) {
  if (error) throw error;
  rw.writeFile("-", iconv.encode(dsv.tsvFormat(dsv.csvParse(iconv.decode(text, commander.inputEncoding))) + os.EOL, commander.outputEncoding), function(error) {
    if (error) throw error;
  });
});
